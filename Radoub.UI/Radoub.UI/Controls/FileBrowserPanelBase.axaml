<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="Radoub.UI.Controls.FileBrowserPanelBase"
             Background="{DynamicResource ThemeSidebar}">

    <UserControl.Styles>
        <!-- Selection visibility fix for dark mode -->
        <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SystemAccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="ListBoxItem:selected:focus /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SystemAccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="ListBoxItem:selected:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource SystemAccentColorDark1}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- Current file highlight -->
        <Style Selector="ListBoxItem.current-file">
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,Auto,*,Auto">
        <!-- Header with collapse button -->
        <Border Grid.Row="0"
                Background="{DynamicResource ThemeTitleBar}"
                Padding="8,4">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock x:Name="HeaderText"
                           Text="Files"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource ThemeTitleBarForeground}"/>
                <Button Grid.Column="1"
                        x:Name="CollapseButton"
                        Content="â—€"
                        Width="24" Height="24"
                        Padding="0"
                        FontSize="10"
                        ToolTip.Tip="Collapse panel"
                        Click="OnCollapseClick"/>
            </Grid>
        </Border>

        <!-- Search and filters -->
        <StackPanel Grid.Row="1" Margin="8,8,8,4" Spacing="4">
            <TextBox x:Name="SearchBox"
                     Watermark="Type to filter..."
                     TextChanged="OnSearchTextChanged"/>

            <!-- Tool-specific filter options go here via ContentPresenter -->
            <ContentPresenter x:Name="FilterOptionsPresenter"
                              Content="{Binding FilterOptionsContent, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
        </StackPanel>

        <!-- File list -->
        <Border Grid.Row="2"
                Margin="8,4,8,8"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="1"
                Background="{DynamicResource ThemeBackground}">
            <Grid RowDefinitions="Auto,*">
                <!-- Count header -->
                <TextBlock Grid.Row="0"
                           x:Name="CountLabel"
                           Text="0 files"
                           Margin="8,4"
                           FontSize="11"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>

                <!-- File ListBox -->
                <ListBox Grid.Row="1"
                         x:Name="FileListBox"
                         SelectionChanged="OnFileSelected"
                         DoubleTapped="OnFileDoubleClicked"
                         Background="Transparent"
                         Margin="4,0,4,4">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DisplayName}"
                                       TextTrimming="CharacterEllipsis"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- Status/loading indicator -->
        <Border Grid.Row="3"
                x:Name="StatusPanel"
                Background="{DynamicResource ThemeTitleBar}"
                Padding="8,4"
                IsVisible="False">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <ProgressBar x:Name="LoadingProgress"
                             IsIndeterminate="True"
                             Width="100"
                             Height="4"
                             VerticalAlignment="Center"/>
                <TextBlock x:Name="StatusText"
                           Text="Loading..."
                           FontSize="11"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource ThemeTitleBarForeground}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
