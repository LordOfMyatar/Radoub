<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="using:Radoub.UI.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Quartermaster.Views.Panels.InventoryPanel"
             x:Name="InventoryPanelInstance">

    <Grid x:Name="InventoryGrid">
        <Grid.ColumnDefinitions>
            <!-- Left: Equipment + Backpack - flexible, resizable via splitter -->
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="5"/>
            <!-- Middle: Item Palette - takes remaining space -->
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="5"/>
            <!-- Right: Item Details - fixed width -->
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>

        <!-- Left Panel: Equipment Slots + Backpack -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <!-- Equipment: 2/3 of space by default, fully resizable via splitter -->
                <RowDefinition Height="2*"/>
                <RowDefinition Height="5"/>
                <!-- Backpack: 1/3 of space by default, fully resizable via splitter -->
                <RowDefinition Height="1*"/>
            </Grid.RowDefinitions>

            <!-- Equipment Slots Panel -->
            <Border Grid.Row="0" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" BorderThickness="1" Margin="5" Padding="5">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Equipment" FontWeight="Bold" Margin="0,0,0,5"/>
                    <controls:EquipmentSlotsPanel x:Name="EquipmentPanel"
                                                   ShowNaturalSlots="True"
                                                   AutomationProperties.AutomationId="EquipmentSlotsPanel"/>
                </DockPanel>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch"
                          Background="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                          AutomationProperties.AutomationId="EquipmentBackpackSplitter"/>

            <!-- Backpack List -->
            <Border Grid.Row="2" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" BorderThickness="1" Margin="5" Padding="5">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Backpack" FontWeight="Bold" Margin="0,0,0,5"/>

                    <!-- Bulk Operations -->
                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Spacing="5" Margin="0,5,0,0">
                        <CheckBox x:Name="BulkDropableCheck" Content="Dropable"
                                  IsEnabled="{Binding HasBackpackSelection, ElementName=InventoryPanelInstance}"
                                  AutomationProperties.AutomationId="BulkDropableCheck"/>
                        <CheckBox x:Name="BulkPickpocketCheck" Content="Pickpocketable"
                                  IsEnabled="{Binding HasBackpackSelection, ElementName=InventoryPanelInstance}"
                                  AutomationProperties.AutomationId="BulkPickpocketCheck"/>
                        <Button Content="Delete Selected" Click="OnDeleteSelectedClick"
                                IsEnabled="{Binding HasBackpackSelection, ElementName=InventoryPanelInstance}"
                                Padding="6,2"
                                AutomationProperties.AutomationId="DeleteSelectedButton"/>
                    </StackPanel>

                    <!-- Backpack Items List -->
                    <controls:ItemListView x:Name="BackpackList"
                                            ContextKey="Backpack"
                                            AutomationProperties.AutomationId="BackpackList"/>
                </DockPanel>
            </Border>
        </Grid>

        <!-- Splitter -->
        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"
                      Background="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                      AutomationProperties.AutomationId="InventoryPaletteSplitter"/>

        <!-- Middle Panel: Item Palette -->
        <Border Grid.Column="2" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" BorderThickness="1" Margin="5" Padding="5">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="Item Palette" FontWeight="Bold" Margin="0,0,0,5"/>

                <!-- Filter Panel -->
                <controls:ItemFilterPanel x:Name="PaletteFilter"
                                           DockPanel.Dock="Top"
                                           ContextKey="Palette"
                                           Margin="0,0,0,5"
                                           AutomationProperties.AutomationId="PaletteFilter"/>

                <!-- Add to Inventory Buttons -->
                <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Spacing="5" Margin="0,5,0,0">
                    <Button Content="Add to Backpack" Click="OnAddToBackpackClick"
                            IsEnabled="{Binding HasPaletteSelection, ElementName=InventoryPanelInstance}"
                            Padding="8,4"
                            AutomationProperties.AutomationId="AddToBackpackButton"/>
                    <Button Content="Equip Selected" Click="OnEquipSelectedClick"
                            IsEnabled="{Binding HasPaletteSelection, ElementName=InventoryPanelInstance}"
                            Padding="8,4"
                            AutomationProperties.AutomationId="EquipSelectedButton"/>
                </StackPanel>

                <!-- Item List -->
                <controls:ItemListView x:Name="PaletteList"
                                        ContextKey="Palette"
                                        AutomationProperties.AutomationId="PaletteList"/>
            </DockPanel>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Stretch"
                      Background="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                      AutomationProperties.AutomationId="PaletteDetailsSplitter"/>

        <!-- Right Panel: Item Details -->
        <Border Grid.Column="4" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" BorderThickness="1" Margin="5" Padding="10">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="Item Details" FontWeight="Bold" Margin="0,0,0,10"/>

                <!-- No Selection Message -->
                <TextBlock x:Name="NoSelectionText"
                           Text="Select an item to view details"
                           FontStyle="Italic"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           IsVisible="True"
                           AutomationProperties.AutomationId="NoSelectionText"/>

                <!-- Item Details Content -->
                <ScrollViewer x:Name="ItemDetailsScroll"
                              VerticalScrollBarVisibility="Auto"
                              IsVisible="False">
                    <StackPanel x:Name="ItemDetailsPanel" Spacing="10">
                        <!-- Icon -->
                        <Border HorizontalAlignment="Center"
                                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                                BorderThickness="1"
                                Padding="10"
                                CornerRadius="4">
                            <Image x:Name="ItemIcon"
                                   Width="64" Height="64"
                                   Stretch="Uniform"
                                   AutomationProperties.AutomationId="ItemIcon"/>
                        </Border>

                        <!-- Item Name -->
                        <TextBlock x:Name="ItemNameText"
                                   Text=""
                                   FontWeight="SemiBold"
                                   FontSize="{DynamicResource FontSizeMedium}"
                                   TextWrapping="Wrap"
                                   HorizontalAlignment="Center"
                                   AutomationProperties.AutomationId="ItemNameText"/>

                        <!-- Base Item Type -->
                        <TextBlock x:Name="ItemTypeText"
                                   Text=""
                                   FontSize="{DynamicResource FontSizeSmall}"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                   HorizontalAlignment="Center"
                                   AutomationProperties.AutomationId="ItemTypeText"/>

                        <!-- Properties Section -->
                        <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                                BorderThickness="0,1,0,0"
                                Padding="0,10,0,0"
                                Margin="0,5,0,0">
                            <StackPanel Spacing="5">
                                <!-- ResRef -->
                                <Grid ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="ResRef:"
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               Margin="0,0,10,0"/>
                                    <TextBlock Grid.Column="1" x:Name="ItemResRefText"
                                               Text=""
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               FontFamily="Consolas"
                                               AutomationProperties.AutomationId="ItemResRefText"/>
                                </Grid>

                                <!-- Tag -->
                                <Grid ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Tag:"
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               Margin="0,0,10,0"/>
                                    <TextBlock Grid.Column="1" x:Name="ItemTagText"
                                               Text=""
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               FontFamily="Consolas"
                                               AutomationProperties.AutomationId="ItemTagText"/>
                                </Grid>

                                <!-- Value -->
                                <Grid ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Value:"
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               Margin="0,0,10,0"/>
                                    <TextBlock Grid.Column="1" x:Name="ItemValueText"
                                               Text=""
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               AutomationProperties.AutomationId="ItemValueText"/>
                                </Grid>

                                <!-- Source -->
                                <Grid ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Source:"
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               Margin="0,0,10,0"/>
                                    <TextBlock Grid.Column="1" x:Name="ItemSourceText"
                                               Text=""
                                               FontSize="{DynamicResource FontSizeSmall}"
                                               AutomationProperties.AutomationId="ItemSourceText"/>
                                </Grid>

                                <!-- Properties -->
                                <TextBlock Text="Properties:"
                                           FontSize="{DynamicResource FontSizeSmall}"
                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                           Margin="0,5,0,0"/>
                                <TextBlock x:Name="ItemPropertiesText"
                                           Text=""
                                           FontSize="{DynamicResource FontSizeSmall}"
                                           TextWrapping="Wrap"
                                           AutomationProperties.AutomationId="ItemPropertiesText"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </DockPanel>
        </Border>
    </Grid>
</UserControl>
