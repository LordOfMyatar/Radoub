<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
        x:Class="Manifest.Views.MainWindow"
        x:Name="MainWindowInstance"
        Title="Manifest - Journal Editor"
        Icon="avares://Manifest/Assets/manifest.ico"
        Width="1000" Height="700"
        MinWidth="600" MinHeight="400"
        KeyDown="OnWindowKeyDown">

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Open..." Click="OnOpenClick" InputGesture="Ctrl+O"/>
                <MenuItem Header="_Save" Click="OnSaveClick" InputGesture="Ctrl+S" IsEnabled="{Binding HasFile}"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="OnExitClick" InputGesture="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" InputGesture="Ctrl+Z" IsEnabled="False"/>
                <MenuItem Header="_Redo" InputGesture="Ctrl+Y" IsEnabled="False"/>
                <Separator/>
                <MenuItem Header="Add _Category" Click="OnAddCategoryClick" IsEnabled="{Binding HasFile}"/>
                <MenuItem Header="Add _Entry" Click="OnAddEntryClick" IsEnabled="{Binding CanAddEntry}"/>
                <Separator/>
                <MenuItem Header="_Delete" Click="OnDeleteClick" InputGesture="Delete" IsEnabled="{Binding HasSelection}"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Settings..." Click="OnPreferencesClick"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About Manifest" Click="OnAboutClick"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" BorderBrush="{DynamicResource SystemBaseMediumLowColor}" BorderThickness="0,0,0,1" Padding="5,3">
            <StackPanel Orientation="Horizontal" Spacing="5">
                <Button Content="ðŸ“‚ Open" Click="OnOpenClick" ToolTip.Tip="Open Journal (Ctrl+O)" Padding="8,4"/>
                <Button Content="ðŸ’¾ Save" Click="OnSaveClick" ToolTip.Tip="Save Journal (Ctrl+S)" IsEnabled="{Binding HasFile}" Padding="8,4"/>
                <Separator Width="1" Margin="5,0" Background="{DynamicResource SystemBaseMediumLowColor}"/>
                <Button Content="ðŸ“+ Category" Click="OnAddCategoryClick" ToolTip.Tip="Add Category (Ctrl+Shift+N)" IsEnabled="{Binding HasFile}" Padding="8,4"/>
                <Button Content="ðŸ“„+ Entry" Click="OnAddEntryClick" ToolTip.Tip="Add Entry (Ctrl+E)" IsEnabled="{Binding CanAddEntry}" Padding="8,4"/>
                <Button Content="ðŸ—‘ Delete" Click="OnDeleteClick" ToolTip.Tip="Delete Selected (Delete)" IsEnabled="{Binding HasSelection}" Padding="8,4"/>
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" BorderBrush="{DynamicResource SystemBaseMediumLowColor}" BorderThickness="0,1,0,0" Padding="5,2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="StatusText" Grid.Column="0" Text="Ready"/>
                <TextBlock x:Name="CountsText" Grid.Column="1" Text="" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="20,0,0,0"/>
                <TextBlock x:Name="TlkStatusText" Grid.Column="2" Text="" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="20,0,0,0"/>
                <TextBlock x:Name="FilePathText" Grid.Column="3" Text="" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="20,0,0,0"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="200"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*" MinWidth="200"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Tree View -->
            <Border Grid.Column="0" BorderBrush="{DynamicResource SystemBaseMediumLowColor}" BorderThickness="1" Margin="5">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Journal Structure" FontWeight="Bold" Margin="5"/>
                    <TreeView x:Name="JournalTree" SelectionChanged="OnTreeSelectionChanged" Padding="0,0,0,20">
                        <TreeView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Add _Category" Click="OnAddCategoryClick" InputGesture="Ctrl+Shift+N" IsEnabled="{Binding HasFile}"/>
                                <MenuItem Header="Add _Entry" Click="OnAddEntryClick" InputGesture="Ctrl+E" IsEnabled="{Binding CanAddEntry}"/>
                                <Separator/>
                                <MenuItem Header="_Delete" Click="OnDeleteClick" InputGesture="Delete" IsEnabled="{Binding HasSelection}"/>
                            </ContextMenu>
                        </TreeView.ContextMenu>
                        <!-- Tree items will be populated from code -->
                    </TreeView>
                </DockPanel>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="{DynamicResource SystemBaseMediumLowColor}"/>

            <!-- Right Panel: Property Editor -->
            <Border Grid.Column="2" BorderBrush="{DynamicResource SystemBaseMediumLowColor}" BorderThickness="1" Margin="5">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Properties" FontWeight="Bold" Margin="5"/>
                    <ScrollViewer>
                        <StackPanel x:Name="PropertyPanel" Margin="10" IsVisible="{Binding HasSelection}">
                            <!-- Category Properties -->
                            <StackPanel x:Name="CategoryProperties" IsVisible="False" Spacing="8">
                                <TextBlock Text="Category Properties" FontWeight="SemiBold"/>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Tag:" Width="80" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CategoryTagBox" Width="200"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="StrRef:" Width="80" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CategoryStrRefBox" Width="150" IsReadOnly="True" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                    <TextBlock x:Name="CategorySourceLabel" Text="" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" FontStyle="Italic" VerticalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Language:" Width="80" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="CategoryLanguageBox" Width="120" SelectionChanged="OnCategoryLanguageChanged"/>
                                    <Button x:Name="CategoryViewAllLangsBtn" Content="View All..." Click="OnViewCategoryLanguages" ToolTip.Tip="View all available translations"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Name:" Width="80" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CategoryNameBox" Width="200"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Priority:" Width="80" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="CategoryPriorityBox" Width="120">
                                        <ComboBoxItem Content="Highest" Tag="0"/>
                                        <ComboBoxItem Content="High" Tag="1"/>
                                        <ComboBoxItem Content="Medium" Tag="2"/>
                                        <ComboBoxItem Content="Low" Tag="3"/>
                                        <ComboBoxItem Content="Lowest" Tag="4"/>
                                    </ComboBox>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="XP:" Width="80" VerticalAlignment="Center"/>
                                    <NumericUpDown x:Name="CategoryXPBox" Width="100" Minimum="0" ShowButtonSpinner="False"/>
                                </StackPanel>

                                <StackPanel Spacing="5">
                                    <TextBlock Text="Comment:"/>
                                    <TextBox x:Name="CategoryCommentBox" Height="60" AcceptsReturn="True" TextWrapping="Wrap"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Entry Properties -->
                            <StackPanel x:Name="EntryProperties" IsVisible="False" Spacing="8">
                                <TextBlock Text="Entry Properties" FontWeight="SemiBold"/>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="ID:" Width="80" VerticalAlignment="Center"/>
                                    <NumericUpDown x:Name="EntryIdBox" Width="150" Minimum="0" ShowButtonSpinner="False"/>
                                </StackPanel>

                                <CheckBox x:Name="EntryEndBox" Content="End (completes category)"/>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="StrRef:" Width="80" VerticalAlignment="Center"/>
                                    <TextBox x:Name="EntryStrRefBox" Width="150" IsReadOnly="True" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                    <TextBlock x:Name="EntrySourceLabel" Text="" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" FontStyle="Italic" VerticalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Language:" Width="80" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="EntryLanguageBox" Width="120" SelectionChanged="OnEntryLanguageChanged"/>
                                    <Button x:Name="EntryViewAllLangsBtn" Content="View All..." Click="OnViewEntryLanguages" ToolTip.Tip="View all available translations"/>
                                </StackPanel>

                                <StackPanel Spacing="5">
                                    <TextBlock Text="Text:"/>
                                    <TextBox x:Name="EntryTextBox" Height="150" AcceptsReturn="True" TextWrapping="Wrap"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- No Selection -->
                            <TextBlock x:Name="NoSelectionText" Text="Select a category or entry to edit its properties."
                                       IsVisible="True" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" FontStyle="Italic"/>
                        </StackPanel>
                    </ScrollViewer>
                </DockPanel>
            </Border>
        </Grid>
    </DockPanel>
</Window>
